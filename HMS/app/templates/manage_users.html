{% extends "base.html" %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

    <!-- Column 1: Create New User Form -->
    <div class="lg:col-span-1 bg-white shadow-lg rounded-lg border-l-4 border-sky-500">
        <form method="POST" action="{{ url_for('main.manage_users') }}" class="p-6 space-y-4">
            <h2 class="text-xl font-bold text-gray-800">Create New User</h2>
            
            <!-- Username -->
            <div>
                <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                <input type="text" id="username" name="username" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500" 
                       required>
            </div>
            
            <!-- Password -->
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" id="password" name="password" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500" 
                       required>
            </div>
            
            <!-- Role -->
            <div>
                <label for="role" class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                <input type="text" id="role" name="role" 
                       value="{{ creatable_role }}" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-600" 
                       readonly>
            </div>

            <!-- Module -->
            <div>
                <label for="module" class="block text-sm font-medium text-gray-700 mb-1">Module</label>
                {% if module_locked %}
                    <!-- Module is locked for Module Admins -->
                    <input type="text" id="module" name="module" 
                           value="{{ creatable_modules[0] }}" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-600" 
                           readonly>
                {% else %}
                    <!-- Super Admin can select a module -->
                    <select id="module" name="module" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500" 
                            required>
                        <option value="" disabled selected>-- Select a Module --</option>
                        {% for module in creatable_modules %}
                            <option value="{{ module }}">{{ module.replace('_', ' ')|title }}</option>
                        {% endfor %}
                    </select>
                {% endif %}
            </div>

            <!-- Submit Button -->
            <div>
                <button type="submit" 
                        class="w-full bg-sky-600 text-white font-bold py-2 px-4 rounded-md shadow-md hover:bg-sky-700 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2">
                    Create User
                </button>
            </div>

        </form>
    </div>

    <!-- Column 2: List of Created Users -->
    <div class="lg:col-span-2 bg-white shadow-md rounded-lg">
        <div class="p-6 border-b border-gray-200">
             <h2 class="text-xl font-bold text-gray-800">
                Users Created by You ({{ created_users|length }})
             </h2>
        </div>
        
        <div class="overflow-x-auto">
            {% if created_users %}
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Module</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for user in created_users %}
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="text-sm font-medium text-gray-900">{{ user.username }}</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                        {% if user.role == 'MODULE_ADMIN' %} bg-blue-100 text-blue-800 
                                        {% else %} bg-green-100 text-green-800 {% endif %}">
                                        {{ user.role.replace('_', ' ')|title }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="text-sm text-gray-700">{{ user.module.replace('_', ' ')|title }}</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <!-- Add actions like Edit/Delete here -->
                                    <a href="#" class="text-sky-600 hover:text-sky-900">Edit</a>
                                    <span class="text-gray-300 mx-1">|</span>
                                    <a href="#" class="text-red-600 hover:text-red-900">Delete</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="p-6 text-gray-500">You have not created any users yet.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
